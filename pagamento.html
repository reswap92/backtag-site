<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>BackTag — Pagamento</title>
  <style>
    :root{
      --bg:#F5ECE1; --ink:#141414; --bronze:#A88C66; --card:#FCF7F0; --line:#D2C3AF;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg); color:var(--ink);
      display:flex; min-height:100dvh; align-items:center; justify-content:center; padding:32px;
    }
    .wrap{max-width:820px; width:100%}
    .logo{display:flex; align-items:center; justify-content:center; margin:24px 0 22px}
    .logo img{width:300px; height:auto}
    .card{
      background:var(--card); border:1.5px solid var(--line); border-radius:28px;
      padding:28px 22px; box-shadow:0 18px 40px rgba(0,0,0,.06)
    }
    h1{text-align:center; font-size:30px; margin:8px 0 10px}
    .row{display:grid; gap:16px; margin:20px auto; max-width:640px}
    .btn-back{
      background:var(--bronze); color:#fff; border:0; border-radius:18px;
      text-align:center; padding:16px 20px; font-weight:700; text-decoration:none
    }
    .small{text-align:center; font-size:14px; opacity:.9; margin-top:14px}
    #paypal-container{max-width:640px; margin:10px auto 0}
  </style>
  <script type="module" src="slots.js"></script>
</head>
<body>
  <main class="wrap">
    <div class="logo">
      <img src="assets/logo-backtag-300.png" alt="BackTag"/>
    </div>

    <section class="card">
      <h1>Totale: € 1,99 — scegli come pagare</h1>

      <!-- PayPal Smart Buttons -->
      <div id="paypal-container"></div>

      <a class="btn-back" href="slot-extra.html">Torna indietro</a>

      <div class="small">Pagamento sicuro. Dopo il pagamento torni al profilo con 10 nuovi slot disponibili.</div>
    </section>
  </main>

  <!-- PayPal SDK -->
  <script src="https://www.paypal.com/sdk/js?client-id=Af9_Axhg9ncsuTlpPqrk75Q4J0diJivqFwkJZhoIp4JjaGMubk23V9ukol8bfs0XdkNnY_Dpin5jmSrG&currency=EUR"></script>
  <script>
    paypal.Buttons({
      style:{shape:'pill', color:'black', layout:'vertical', label:'paypal'},
      createOrder: function(data, actions) {
        return actions.order.create({
          intent: "CAPTURE",
          purchase_units: [{
            amount: { currency_code: "EUR", value: "1.99" },
            description: "BackTag - +10 slot"
          }]
        });
      },
      onApprove: async function(data, actions) {
        const details = await actions.order.capture(); // Pagamento OK
        try {
          await window.BackTagSlots.addTenSlots(); // aggiorna Firestore
        } catch(e) {
          console.error(e);
        }
        window.location.href = "profilo.html?paid=slots10";
      },
      onError: function(err){
        console.error('PayPal error', err);
        alert('Pagamento non riuscito. Riprova.');
      }
    }).render('#paypal-container');
  </script>
</body>
</html>
