<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Profilo - BackTag</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import {
      getFirestore,
      collection,
      query,
      where,
      getDocs
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD0kpQb-t5aJrMQ9mNnvJgl53Fe8UgPwrc",
      authDomain: "backtag-16de3.firebaseapp.com",
      projectId: "backtag-16de3",
      storageBucket: "backtag-16de3.firebasestorage.app",
      messagingSenderId: "415455463905",
      appId: "1:415455463905:web:abd5e58bdeaaf6e3b9eaa0",
      measurementId: "G-6565LXTZW7"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const slotContainer = document.getElementById("slotContainer");

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        slotContainer.innerHTML = "<p>Non sei autenticato. Vai su <a href='attiva.html'>attiva.html</a></p>";
        return;
      }

      const qrRef = collection(db, "qrcodes");
      const q = query(qrRef, where("email", "==", user.email));
      const snapshot = await getDocs(q);
      const qrList = snapshot.docs.map(doc => doc.data());

      // Costruzione slot 0-5
      for (let i = 0; i < 6; i++) {
        const qr = qrList.find(qr => qr.slotIndex === i);
        const div = document.createElement("div");
        div.className = "slot";

        if (qr) {
          div.innerHTML = `
            <div class="slot-label">${qr.label}</div>
            <div style="font-size: 14px; color: #666;">Codice: ${qr.code}</div>
          `;
        } else {
          div.innerHTML = `
            <button onclick="location.href='attiva.html?slot=${i}'">+</button>
            <div class="slot-label">Attiva un QR</div>
          `;
        }

        slotContainer.appendChild(div);
      }
    });
  </script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f7f0e7;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
    }
    .logo img {
      height: 400px;
    }
    .logout-button {
      background-color: #000;
      color: white;
      font-weight: bold;
      border: none;
      border-radius: 5px;
      padding: 10px 20px;
      cursor: pointer;
    }
    h1 {
      font-size: 32px;
      margin-top: 10px;
    }
    .slot-container {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin: 40px auto;
      max-width: 800px;
    }
    .slot {
      background-color: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .slot button {
      background-color: #a58c6b;
      color: white;
      font-size: 32px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: none;
      cursor: pointer;
    }
    .slot-label {
      font-weight: bold;
      margin-top: 12px;
      font-size: 16px;
      color: #444;
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">
      <img src="logo-backtag.png" alt="Logo BackTag">
    </div>
    <button class="logout-button" onclick="location.href='index.html'">Esci</button>
  </header>

  <h1>QR attivi</h1>

  <div class="slot-container" id="slotContainer">
    <p>Caricamento slot...</p>
  </div>
</body>
</html>
